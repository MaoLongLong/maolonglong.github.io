<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>goroutine ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç† | æ¯›ç‘ç‘çš„åšå®¢</title><meta property="og:title" content="goroutine ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç† - æ¯›ç‘ç‘çš„åšå®¢"><meta property="og:type" content="article"><meta property="article:published_time" content="2021-07-07T17:15:08+08:00"><meta property="article:modified_time" content="2021-07-07T17:15:08+08:00"><meta name=Keywords content><meta name=description content="goroutine ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†"><meta name=author content="æ¯›ç‘ç‘"><meta property="og:url" content="https://maolonglong.tech/post/golang/goroutine-lifecycles/"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=stylesheet href=/css/normalize.css><link rel=stylesheet href=/css/style.css><script type=text/javascript src=//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js></script><script>var _hmt=_hmt||[];(function(){var a=document.createElement("script"),b;a.src="https://hm.baidu.com/hm.js?b88ba8bad63352d4213631c01bab502f",b=document.getElementsByTagName("script")[0],b.parentNode.insertBefore(a,b)})()</script><link href=https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css rel=stylesheet></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><a id=logo href=https://maolonglong.tech>æ¯›ç‘ç‘çš„åšå®¢</a><p class=description>åªæœ‰éå¸¸åŠªåŠ›ï¼Œæ‰èƒ½æ˜¾å¾—æ¯«ä¸è´¹åŠ›</p></div><div><nav id=nav-menu class=clearfix><a class=current href=https://maolonglong.tech>é¦–é¡µ</a>
<a href=https://maolonglong.tech/archives/ title=å½’æ¡£>å½’æ¡£</a>
<a href=https://maolonglong.tech/about/ title=å…³äº>å…³äº</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>goroutine ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†</h1></header><date class="post-meta meta-date">2021å¹´7æœˆ7æ—¥</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=/categories/Golang>Golang</a></span></div><div class=post-content><h2 id=æ ‡å‡†åº“-context-åŒ…>æ ‡å‡†åº“ context åŒ…</h2><p>æ ‡å‡†åº“çš„ context åŒ…ä¸­ä¸»è¦å°±æ˜¯å‡ ç§æ§åˆ¶ goroutine ç”Ÿå‘½å‘¨æœŸçš„æ–¹æ³•ï¼š</p><ul><li><code>WithCancel</code>: æ‰‹åŠ¨æ§åˆ¶ç»“æŸ</li><li><code>WithTimeout</code>: æŒ‡å®šè¶…æ—¶æ—¶é—´åç»“æŸ</li><li><code>WithDeadline</code>: æŒ‡å®šæ—¶é—´ç»“æŸ</li></ul><p>ä¸‹é¢çš„æ ·ä¾‹æ¼”ç¤ºäº†ç”Ÿæˆç‰¹å®šéšæœºæ•°å<strong>æ‰‹åŠ¨ç»“æŸ</strong> goroutine çš„æ“ä½œï¼Œå®ƒä¼šéšæœºæ‰“å°å‡ æ¬¡ &ldquo;running&mldr;&rdquo;</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000;font-weight:700>package</span> main

<span style=color:#000;font-weight:700>import</span> (
	<span style=color:#d14>&#34;context&#34;</span>
	<span style=color:#d14>&#34;fmt&#34;</span>
	<span style=color:#d14>&#34;math/rand&#34;</span>
	<span style=color:#d14>&#34;sync&#34;</span>
	<span style=color:#d14>&#34;time&#34;</span>
)

<span style=color:#000;font-weight:700>func</span> <span style=color:#900;font-weight:700>main</span>() {
	rand.<span style=color:#900;font-weight:700>Seed</span>(time.<span style=color:#900;font-weight:700>Now</span>().<span style=color:#900;font-weight:700>UnixNano</span>())
	ctx, cancel <span style=color:#000;font-weight:700>:=</span> context.<span style=color:#900;font-weight:700>WithCancel</span>(context.<span style=color:#900;font-weight:700>Background</span>())

	<span style=color:#000;font-weight:700>var</span> wg sync.WaitGroup
	wg.<span style=color:#900;font-weight:700>Add</span>(<span style=color:#099>1</span>)

	<span style=color:#000;font-weight:700>go</span> <span style=color:#000;font-weight:700>func</span>(ctx context.Context) {
		<span style=color:#000;font-weight:700>defer</span> wg.<span style=color:#900;font-weight:700>Done</span>()
		<span style=color:#000;font-weight:700>for</span> {
			<span style=color:#000;font-weight:700>select</span> {
			<span style=color:#000;font-weight:700>default</span>:
				time.<span style=color:#900;font-weight:700>Sleep</span>(time.Second)
				fmt.<span style=color:#900;font-weight:700>Println</span>(<span style=color:#d14>&#34;running...&#34;</span>)
			<span style=color:#000;font-weight:700>case</span> <span style=color:#000;font-weight:700>&lt;-</span>ctx.<span style=color:#900;font-weight:700>Done</span>():
				fmt.<span style=color:#900;font-weight:700>Println</span>(<span style=color:#d14>&#34;done&#34;</span>)
				<span style=color:#000;font-weight:700>return</span>
			}
		}
	}(ctx)

	<span style=color:#000;font-weight:700>for</span> {
		time.<span style=color:#900;font-weight:700>Sleep</span>(time.Second)
		<span style=color:#000;font-weight:700>if</span> rand.<span style=color:#900;font-weight:700>Intn</span>(<span style=color:#099>10</span>) &lt; <span style=color:#099>3</span> {
			<span style=color:#900;font-weight:700>cancel</span>()
			<span style=color:#000;font-weight:700>break</span>
		}
	}

	wg.<span style=color:#900;font-weight:700>Wait</span>()
}
</code></pre></td></tr></table></div></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œcontext å¹¶ä¸èƒ½ç›´æ¥è®© goroutine ç»“æŸï¼ŒçœŸæ­£è®© goroutine ç»“æŸçš„æ˜¯å®ƒè‡ªå·±ã€‚é€šè¿‡ select è¯­å¥ä¸­çš„ <code>case &lt;-ctx.Done()</code> æ¥æ”¶åˆ°äº† <code>cancel()</code> å‘å‡ºçš„â€œé€šçŸ¥â€ï¼Œç„¶åä½œå‡ºç›¸åº”çš„ç»“æŸæ“ä½œã€‚ï¼ˆäº‹å®ä¸Šå®ƒå®Œå…¨å¯ä»¥é€‰æ‹©ä¸å¬ context çš„ï¼‰</p><p>å¦‚æœæƒ…å†µå¤æ‚äº›ï¼Œå­ goroutine åˆ go äº†ä¸ªå­™å­ goroutineï¼Œæ§åˆ¶å®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸåªéœ€è¦æŠŠ <code>ctx</code> ä¸€ç›´ä¼ ä¸‹å»å³å¯ï¼Œæ‰€æœ‰ goroutine ç»„æˆçš„ç»“æ„å°±åƒä¸€æ£µä» <code>context.Background()</code> å±•å¼€çš„æ ‘ã€‚</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000;font-weight:700>package</span> main

<span style=color:#000;font-weight:700>import</span> (
	<span style=color:#d14>&#34;context&#34;</span>
	<span style=color:#d14>&#34;fmt&#34;</span>
	<span style=color:#d14>&#34;sync&#34;</span>
	<span style=color:#d14>&#34;time&#34;</span>
)

<span style=color:#000;font-weight:700>var</span> wg sync.WaitGroup

<span style=color:#000;font-weight:700>func</span> <span style=color:#900;font-weight:700>main</span>() {
	ctx, cancel <span style=color:#000;font-weight:700>:=</span> context.<span style=color:#900;font-weight:700>WithTimeout</span>(context.<span style=color:#900;font-weight:700>Background</span>(), <span style=color:#099>3</span><span style=color:#000;font-weight:700>*</span>time.Second)
	<span style=color:#000;font-weight:700>defer</span> <span style=color:#900;font-weight:700>cancel</span>()

	wg.<span style=color:#900;font-weight:700>Add</span>(<span style=color:#099>1</span>)
	<span style=color:#000;font-weight:700>go</span> <span style=color:#900;font-weight:700>worker1</span>(ctx)

	wg.<span style=color:#900;font-weight:700>Wait</span>()
}

<span style=color:#000;font-weight:700>func</span> <span style=color:#900;font-weight:700>worker1</span>(ctx context.Context) {
	<span style=color:#000;font-weight:700>defer</span> wg.<span style=color:#900;font-weight:700>Done</span>()

	wg.<span style=color:#900;font-weight:700>Add</span>(<span style=color:#099>1</span>)
	<span style=color:#000;font-weight:700>go</span> <span style=color:#900;font-weight:700>worker2</span>(ctx)

	<span style=color:#000;font-weight:700>for</span> {
		<span style=color:#000;font-weight:700>select</span> {
		<span style=color:#000;font-weight:700>default</span>:
			time.<span style=color:#900;font-weight:700>Sleep</span>(time.Second)
			fmt.<span style=color:#900;font-weight:700>Println</span>(<span style=color:#d14>&#34;worker1 running...&#34;</span>)
		<span style=color:#000;font-weight:700>case</span> <span style=color:#000;font-weight:700>&lt;-</span>ctx.<span style=color:#900;font-weight:700>Done</span>():
			fmt.<span style=color:#900;font-weight:700>Println</span>(<span style=color:#d14>&#34;worker1 done&#34;</span>)
			<span style=color:#000;font-weight:700>return</span>
		}
	}
}

<span style=color:#000;font-weight:700>func</span> <span style=color:#900;font-weight:700>worker2</span>(ctx context.Context) {
	<span style=color:#000;font-weight:700>defer</span> wg.<span style=color:#900;font-weight:700>Done</span>()

	<span style=color:#000;font-weight:700>for</span> {
		<span style=color:#000;font-weight:700>select</span> {
		<span style=color:#000;font-weight:700>default</span>:
			time.<span style=color:#900;font-weight:700>Sleep</span>(time.Second)
			fmt.<span style=color:#900;font-weight:700>Println</span>(<span style=color:#d14>&#34;worker2 running...&#34;</span>)
		<span style=color:#000;font-weight:700>case</span> <span style=color:#000;font-weight:700>&lt;-</span>ctx.<span style=color:#900;font-weight:700>Done</span>():
			fmt.<span style=color:#900;font-weight:700>Println</span>(<span style=color:#d14>&#34;worker2 done&#34;</span>)
			<span style=color:#000;font-weight:700>return</span>
		}
	}
}
</code></pre></td></tr></table></div></div><p>ä» <code>cancel()</code> çš„æºç ä¸­ä¸éš¾çœ‹å‡ºï¼Œå®ƒç¡®å®å¯¹æ‰€æœ‰å­ goroutine éƒ½åšäº† cancel æ“ä½œï¼š</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000;font-weight:700>func</span> (c <span style=color:#000;font-weight:700>*</span>cancelCtx) <span style=color:#900;font-weight:700>cancel</span>(removeFromParent <span style=color:#458;font-weight:700>bool</span>, err <span style=color:#458;font-weight:700>error</span>) {
	<span style=color:#998;font-style:italic>// ......
</span><span style=color:#998;font-style:italic></span>
	<span style=color:#000;font-weight:700>for</span> child <span style=color:#000;font-weight:700>:=</span> <span style=color:#000;font-weight:700>range</span> c.children {
		child.<span style=color:#900;font-weight:700>cancel</span>(<span style=color:#000;font-weight:700>false</span>, err)
	}

	<span style=color:#998;font-style:italic>// ......
</span><span style=color:#998;font-style:italic></span>}
</code></pre></td></tr></table></div></div><h2 id=å¤æ‚è°ƒåº¦>å¤æ‚è°ƒåº¦</h2><p><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/MaoLongLong/maolonglong.github.io@gh-pages/post/golang/goroutine-lifecycles/images/youtube_LHe1Cb_Ud_M.png><img class=mx-auto alt src=https://cdn.jsdelivr.net/gh/MaoLongLong/maolonglong.github.io@gh-pages/post/golang/goroutine-lifecycles/images/youtube_LHe1Cb_Ud_M.png></a></p><p>è¯•æƒ³ä¸€ç§åœºæ™¯ï¼šä¸€ä¸ªç¨‹åºç”±å¤šä¸ªæœåŠ¡ç»„æˆã€‚å…¶ä¸­ä¸€ä¸ªæœåŠ¡ç”±äºæŸç§åŸå› å…³é—­åï¼ŒåŒæ—¶ä¹Ÿè¦è®©å…¶ä»–æ­£å¸¸è¿è¡Œçš„æœåŠ¡å…³é—­ã€‚å¹¶ä¸”å®ƒä»¬éƒ½éœ€è¦ç›‘å¬é”®ç›˜äº‹ä»¶ï¼Œåœ¨æŒ‰ä¸‹ Ctrl-C æ—¶é€€å‡ºã€‚</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go>ctx, cancel <span style=color:#000;font-weight:700>:=</span> context.<span style=color:#900;font-weight:700>WithCancel</span>(context.<span style=color:#900;font-weight:700>Background</span>())

<span style=color:#000;font-weight:700>go</span> <span style=color:#900;font-weight:700>StorageService</span>()
<span style=color:#000;font-weight:700>go</span> <span style=color:#900;font-weight:700>StateMachine</span>()
<span style=color:#000;font-weight:700>go</span> <span style=color:#900;font-weight:700>HttpApi</span>()
<span style=color:#000;font-weight:700>go</span> <span style=color:#900;font-weight:700>CronService</span>()

<span style=color:#998;font-style:italic>// wait...
</span></code></pre></td></tr></table></div></div><p>ç›´æ¥ç”¨ context è‚¯å®šèƒ½å®ç°ï¼Œä½†å†™èµ·æ¥ç¡®å®è®©äººå¤´ç§ƒã€‚æˆ‘ä»¬å¯ä»¥å€Ÿé‰´ä¸€äº›å·²ç»å°è£…å¥½çš„åº“ï¼Œå…¶ä¸­ä¹‹ä¸€å°±æ˜¯ <a href=https://github.com/oklog/run>oklog/run</a>ï¼Œå®ƒçš„æ ¸å¿ƒä»£ç åªæœ‰ 30 è¡Œå·¦å³ã€‚</p><p>å…ˆçœ‹ç®€å•çš„ä½¿ç”¨æ•ˆæœï¼š</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000;font-weight:700>package</span> main

<span style=color:#000;font-weight:700>import</span> (
	<span style=color:#d14>&#34;context&#34;</span>
	<span style=color:#d14>&#34;errors&#34;</span>
	<span style=color:#d14>&#34;fmt&#34;</span>
	<span style=color:#d14>&#34;log&#34;</span>
	<span style=color:#d14>&#34;time&#34;</span>

	<span style=color:#d14>&#34;github.com/oklog/run&#34;</span>
)

<span style=color:#000;font-weight:700>var</span> errCh = <span style=color:#0086b3>make</span>(<span style=color:#000;font-weight:700>chan</span> <span style=color:#458;font-weight:700>error</span>)

<span style=color:#000;font-weight:700>func</span> <span style=color:#900;font-weight:700>main</span>() {

	<span style=color:#000;font-weight:700>var</span> g run.Group
	{
		g.<span style=color:#900;font-weight:700>Add</span>(<span style=color:#900;font-weight:700>mockService</span>(<span style=color:#d14>&#34;Storage service&#34;</span>))
		g.<span style=color:#900;font-weight:700>Add</span>(<span style=color:#900;font-weight:700>mockService</span>(<span style=color:#d14>&#34;State machine&#34;</span>))
		g.<span style=color:#900;font-weight:700>Add</span>(<span style=color:#900;font-weight:700>mockService</span>(<span style=color:#d14>&#34;HTTP API&#34;</span>))
		g.<span style=color:#900;font-weight:700>Add</span>(<span style=color:#900;font-weight:700>mockService</span>(<span style=color:#d14>&#34;Cron service&#34;</span>))
		g.<span style=color:#900;font-weight:700>Add</span>(run.<span style=color:#900;font-weight:700>SignalHandler</span>(context.<span style=color:#900;font-weight:700>Background</span>()))
	}

	<span style=color:#000;font-weight:700>go</span> <span style=color:#900;font-weight:700>mockError</span>()

	<span style=color:#000;font-weight:700>if</span> err <span style=color:#000;font-weight:700>:=</span> g.<span style=color:#900;font-weight:700>Run</span>(); err <span style=color:#000;font-weight:700>!=</span> <span style=color:#000;font-weight:700>nil</span> {
		log.<span style=color:#900;font-weight:700>Println</span>(<span style=color:#d14>&#34;run group err:&#34;</span>, err)
	}
}

<span style=color:#000;font-weight:700>func</span> <span style=color:#900;font-weight:700>mockService</span>(name <span style=color:#458;font-weight:700>string</span>) (<span style=color:#000;font-weight:700>func</span>() <span style=color:#458;font-weight:700>error</span>, <span style=color:#000;font-weight:700>func</span>(<span style=color:#458;font-weight:700>error</span>)) {
	ctx, cancel <span style=color:#000;font-weight:700>:=</span> context.<span style=color:#900;font-weight:700>WithCancel</span>(context.<span style=color:#900;font-weight:700>Background</span>())
	<span style=color:#000;font-weight:700>return</span> <span style=color:#000;font-weight:700>func</span>() <span style=color:#458;font-weight:700>error</span> {
			log.<span style=color:#900;font-weight:700>Printf</span>(<span style=color:#d14>&#34;%s start...\n&#34;</span>, name)
			<span style=color:#000;font-weight:700>select</span> {
			<span style=color:#000;font-weight:700>case</span> <span style=color:#000;font-weight:700>&lt;-</span>ctx.<span style=color:#900;font-weight:700>Done</span>():
				<span style=color:#000;font-weight:700>return</span> <span style=color:#000;font-weight:700>nil</span>
			<span style=color:#000;font-weight:700>case</span> err <span style=color:#000;font-weight:700>:=</span> <span style=color:#000;font-weight:700>&lt;-</span>errCh:
				log.<span style=color:#900;font-weight:700>Printf</span>(<span style=color:#d14>&#34;%s exit with err: %s\n&#34;</span>, name, err.<span style=color:#900;font-weight:700>Error</span>())
				<span style=color:#000;font-weight:700>return</span> fmt.<span style=color:#900;font-weight:700>Errorf</span>(<span style=color:#d14>&#34;%s - %w&#34;</span>, name, err)
			}
		}, <span style=color:#000;font-weight:700>func</span>(err <span style=color:#458;font-weight:700>error</span>) {
			log.<span style=color:#900;font-weight:700>Printf</span>(<span style=color:#d14>&#34;%s stop, cause: %s\n&#34;</span>, name, err.<span style=color:#900;font-weight:700>Error</span>())
			<span style=color:#900;font-weight:700>cancel</span>()
		}
}

<span style=color:#000;font-weight:700>func</span> <span style=color:#900;font-weight:700>mockError</span>() {
	time.<span style=color:#900;font-weight:700>Sleep</span>(<span style=color:#099>3</span> <span style=color:#000;font-weight:700>*</span> time.Second)
	errCh <span style=color:#000;font-weight:700>&lt;-</span> errors.<span style=color:#900;font-weight:700>New</span>(<span style=color:#d14>&#34;mock error&#34;</span>)
}
</code></pre></td></tr></table></div></div><p>è¾“å‡ºï¼š</p><pre><code class=language-log data-lang=log>2021/07/07 21:21:04 HTTP API start...
2021/07/07 21:21:04 State machine start...
2021/07/07 21:21:04 Cron service start...
2021/07/07 21:21:04 Storage service start...
2021/07/07 21:21:07 HTTP API exit with err: mock error
2021/07/07 21:21:07 Storage service stop, cause: HTTP API - mock error
2021/07/07 21:21:07 State machine stop, cause: HTTP API - mock error
2021/07/07 21:21:07 HTTP API stop, cause: HTTP API - mock error
2021/07/07 21:21:07 Cron service stop, cause: HTTP API - mock error
2021/07/07 21:21:07 run group err: HTTP API - mock error
</code></pre><p>Run Group æŠŠ<strong>æ‰§è¡Œå‡½æ•°</strong>å’Œ<strong>ä¸­æ–­å‡½æ•°</strong>å°è£…æˆäº†ä¸€ä¸ª actor ç»“æ„ä½“ï¼ˆä¸­æ–­å‡½æ•°éœ€è¦è®©æ‰§è¡Œå‡½æ•°è¿”å›ï¼‰</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000;font-weight:700>type</span> actor <span style=color:#000;font-weight:700>struct</span> {
	execute   <span style=color:#000;font-weight:700>func</span>() <span style=color:#458;font-weight:700>error</span>
	interrupt <span style=color:#000;font-weight:700>func</span>(<span style=color:#458;font-weight:700>error</span>)
}
</code></pre></td></tr></table></div></div><p>Group ä»…ç”±ä¸€ä¸ª actor åˆ‡ç‰‡ç»„æˆ</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000;font-weight:700>type</span> Group <span style=color:#000;font-weight:700>struct</span> {
	actors []actor
}
</code></pre></td></tr></table></div></div><p>Add æ–¹æ³•å°±æ˜¯ç®€å•çš„å°† actor åŠ å…¥ Groupï¼š</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000;font-weight:700>func</span> (g <span style=color:#000;font-weight:700>*</span>Group) <span style=color:#900;font-weight:700>Add</span>(execute <span style=color:#000;font-weight:700>func</span>() <span style=color:#458;font-weight:700>error</span>, interrupt <span style=color:#000;font-weight:700>func</span>(<span style=color:#458;font-weight:700>error</span>)) {
	g.actors = <span style=color:#0086b3>append</span>(g.actors, actor{execute, interrupt})
}
</code></pre></td></tr></table></div></div><p>æ ¸å¿ƒéƒ¨åˆ†ï¼ŒRun æ–¹æ³•ï¼š</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000;font-weight:700>func</span> (g <span style=color:#000;font-weight:700>*</span>Group) <span style=color:#900;font-weight:700>Run</span>() <span style=color:#458;font-weight:700>error</span> {
	<span style=color:#000;font-weight:700>if</span> <span style=color:#0086b3>len</span>(g.actors) <span style=color:#000;font-weight:700>==</span> <span style=color:#099>0</span> {
		<span style=color:#000;font-weight:700>return</span> <span style=color:#000;font-weight:700>nil</span>
	}

	<span style=color:#998;font-style:italic>// è¿è¡Œæ‰€æœ‰ actor
</span><span style=color:#998;font-style:italic></span>	errors <span style=color:#000;font-weight:700>:=</span> <span style=color:#0086b3>make</span>(<span style=color:#000;font-weight:700>chan</span> <span style=color:#458;font-weight:700>error</span>, <span style=color:#0086b3>len</span>(g.actors))
	<span style=color:#000;font-weight:700>for</span> _, a <span style=color:#000;font-weight:700>:=</span> <span style=color:#000;font-weight:700>range</span> g.actors {
		<span style=color:#000;font-weight:700>go</span> <span style=color:#000;font-weight:700>func</span>(a actor) {
			errors <span style=color:#000;font-weight:700>&lt;-</span> a.<span style=color:#900;font-weight:700>execute</span>()
		}(a)
	}

	<span style=color:#998;font-style:italic>// ç­‰å¾…å…¶ä¸­ä¸€ä¸ª actor çš„æ‰§è¡Œå‡½æ•°è¿”å›ï¼ˆå¯èƒ½æ˜¯æ­£å¸¸è¿”å›ä¹Ÿå¯èƒ½æ˜¯é”™è¯¯è¿”å›ï¼‰
</span><span style=color:#998;font-style:italic></span>	err <span style=color:#000;font-weight:700>:=</span> <span style=color:#000;font-weight:700>&lt;-</span>errors

	<span style=color:#998;font-style:italic>// é€šçŸ¥æ‰€æœ‰ actor ç»“æŸï¼ˆæ‰§è¡Œä¸­æ–­å‡½æ•°ï¼‰
</span><span style=color:#998;font-style:italic></span>	<span style=color:#000;font-weight:700>for</span> _, a <span style=color:#000;font-weight:700>:=</span> <span style=color:#000;font-weight:700>range</span> g.actors {
		a.<span style=color:#900;font-weight:700>interrupt</span>(err)
	}

	<span style=color:#998;font-style:italic>// ç­‰å¾…æ‰€æœ‰ actor çœŸæ­£ç»“æŸ
</span><span style=color:#998;font-style:italic></span>	<span style=color:#000;font-weight:700>for</span> i <span style=color:#000;font-weight:700>:=</span> <span style=color:#099>1</span>; i &lt; <span style=color:#0086b3>cap</span>(errors); i<span style=color:#000;font-weight:700>++</span> {
		<span style=color:#000;font-weight:700>&lt;-</span>errors
	}

	<span style=color:#998;font-style:italic>// è¿”å›å¾—åˆ°çš„ç¬¬ä¸€ä¸ª error
</span><span style=color:#998;font-style:italic></span>	<span style=color:#000;font-weight:700>return</span> err
}
</code></pre></td></tr></table></div></div><blockquote><p>ç±»ä¼¼çš„é¡¹ç›®è¿˜æœ‰ <a href=https://github.com/go-tomb/tomb/tree/v2>tomb</a> å’Œ <a href=https://github.com/golang/sync/blob/master/errgroup/errgroup.go>errgroup</a></p></blockquote></div><div class=post-archive><h2>See Also</h2><ul class=listing><li><a href=/post/golang/functional-options/>Go å‡½æ•°é€‰é¡¹æ¨¡å¼ï¼ˆFunctional Optionsï¼‰</a></li><li><a href=/post/golang/bytebufferpool/>é«˜æ€§èƒ½å­—èŠ‚æ± è®¾è®¡ | bytebufferpool æºç åˆ†æ</a></li><li><a href=/post/golang/queue/>æ— é”é˜Ÿåˆ—çš„ç®€å•å®ç°</a></li><li><a href=/post/blockchain/cryptographic-hash-functions/>æ¯”ç‰¹å¸ç¬”è®° â€”â€” å“ˆå¸Œå‡½æ•°</a></li><li><a href=/post/golang/unsafe/>Unsafe Go</a></li></ul></div><div class="post-meta meta-tags"><ul class=clearfix><li><a href=/tags/goroutine>goroutine</a></li></ul></div></article><div class="post bg-white"><script src=https://utteranc.es/client.js repo=MaoLongLong/maolonglong.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div><footer id=footer><div>&copy; 2021 <a href=https://maolonglong.tech>æ¯›ç‘ç‘çš„åšå®¢ By æ¯›ç‘ç‘</a></div><br><div><div class=github-badge><a href=https://gohugo.io/ target=_black rel=nofollow><span class=badge-subject>Powered by</span><span class="badge-value bg-blue">Hugo</span></a></div><div class=github-badge><a href=https://www.flysnow.org/ target=_black><span class=badge-subject>Design by</span><span class="badge-value bg-brightgreen">é£é›ªæ— æƒ…</span></a></div><div class=github-badge><a href=https://github.com/flysnow-org/maupassant-hugo target=_black><span class=badge-subject>Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a></div></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:!0}}</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><script src=https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js></script><a id=rocket href=#top></a><script type=text/javascript src="/js/totop.js?v=0.0.0" async></script></div><div id=secondary><section class=widget><form id=search action=https://maolonglong.tech/search/ method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=Search>
<input type=hidden name=sitesearch value=https://maolonglong.tech>
<button type=submit class="submit icon-search"></button></form></section><section class=widget><h3 class=widget-title>æœ€è¿‘æ–‡ç« </h3><ul class=widget-list><li><a href=https://maolonglong.tech/post/golang/goroutine-lifecycles/ title="goroutine ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†">goroutine ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†</a></li><li><a href=https://maolonglong.tech/post/golang/functional-options/ title="Go å‡½æ•°é€‰é¡¹æ¨¡å¼ï¼ˆFunctional Optionsï¼‰">Go å‡½æ•°é€‰é¡¹æ¨¡å¼ï¼ˆFunctional Optionsï¼‰</a></li><li><a href=https://maolonglong.tech/post/golang/bytebufferpool/ title="é«˜æ€§èƒ½å­—èŠ‚æ± è®¾è®¡ | bytebufferpool æºç åˆ†æ">é«˜æ€§èƒ½å­—èŠ‚æ± è®¾è®¡ | bytebufferpool æºç åˆ†æ</a></li><li><a href=https://maolonglong.tech/post/golang/queue/ title=æ— é”é˜Ÿåˆ—çš„ç®€å•å®ç°>æ— é”é˜Ÿåˆ—çš„ç®€å•å®ç°</a></li><li><a href=https://maolonglong.tech/post/blockchain/cryptographic-hash-functions/ title="æ¯”ç‰¹å¸ç¬”è®° â€”â€” å“ˆå¸Œå‡½æ•°">æ¯”ç‰¹å¸ç¬”è®° â€”â€” å“ˆå¸Œå‡½æ•°</a></li><li><a href=https://maolonglong.tech/post/golang/unsafe/ title="Unsafe Go">Unsafe Go</a></li><li><a href=https://maolonglong.tech/post/%E7%94%9F%E6%B4%BB/%E6%96%B0%E7%9A%84%E5%BC%80%E5%A7%8B/ title=æ–°çš„å¼€å§‹>æ–°çš„å¼€å§‹</a></li><li><a href=https://maolonglong.tech/post/java/reentrant-lock/ title="ã€Java å¹¶å‘ã€‘é‡å…¥é”ï¼ˆReentrantLockï¼‰">ã€Java å¹¶å‘ã€‘é‡å…¥é”ï¼ˆReentrantLockï¼‰</a></li><li><a href=https://maolonglong.tech/post/java/volatile/ title="ã€Java å¹¶å‘ã€‘volatile å…³é”®å­—åŸºæœ¬ç†è§£ä¸ä½¿ç”¨">ã€Java å¹¶å‘ã€‘volatile å…³é”®å­—åŸºæœ¬ç†è§£ä¸ä½¿ç”¨</a></li></ul></section><section class=widget><h3 class=widget-title style=color:red>ç¦åˆ©æ´¾é€</h3><ul class=widget-list><li><a href="https://pages.aliyundrive.com/mobile-page/web/beinvited.html?code=0d9686e" title="æˆ‘åœ¨ä½¿ç”¨ä¸é™é€Ÿã€Œé˜¿é‡Œäº‘ç›˜ã€ï¼Œèµ é€ä½  500GB å¿«æ¥è¯•è¯•å§ ğŸ‰" target=_blank style=color:red><img src=/aliyundrive.png></a></li></ul></section><section class=widget><h3 class=widget-title><a href=/categories/>åˆ†ç±»</a></h3><ul class=widget-list><li><a href=https://maolonglong.tech/categories/Golang/>Golang (5)</a></li><li><a href=https://maolonglong.tech/categories/Java/>Java (2)</a></li><li><a href=https://maolonglong.tech/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/>åŒºå—é“¾ (1)</a></li><li><a href=https://maolonglong.tech/categories/%E7%94%9F%E6%B4%BB/>ç”Ÿæ´» (1)</a></li></ul></section><section class=widget><h3 class=widget-title><a href=/tags/>æ ‡ç­¾</a></h3><div class=tagcloud><a href=https://maolonglong.tech/tags/Bitcoin/>Bitcoin</a>
<a href=https://maolonglong.tech/tags/CAS/>CAS</a>
<a href=https://maolonglong.tech/tags/Pool/>Pool</a>
<a href=https://maolonglong.tech/tags/ReentrantLock/>ReentrantLock</a>
<a href=https://maolonglong.tech/tags/SHA256/>SHA256</a>
<a href=https://maolonglong.tech/tags/goroutine/>goroutine</a>
<a href=https://maolonglong.tech/tags/unsafe/>unsafe</a>
<a href=https://maolonglong.tech/tags/volatile/>volatile</a>
<a href=https://maolonglong.tech/tags/%E5%AE%9E%E4%B9%A0/>å®ä¹ </a>
<a href=https://maolonglong.tech/tags/%E5%B9%B6%E5%8F%91/>å¹¶å‘</a>
<a href=https://maolonglong.tech/tags/%E7%AB%9E%E8%B5%9B/>ç«èµ›</a>
<a href=https://maolonglong.tech/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/>è®¾è®¡æ¨¡å¼</a></div></section><section class=widget><h3 class=widget-title>å…¶å®ƒ</h3><ul class=widget-list><li><a href=https://maolonglong.tech/index.xml>æ–‡ç«  RSS</a></li></ul></section></div></div></div></div></body></html>